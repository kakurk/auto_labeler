FROM python:3.12

WORKDIR /app

RUN pip install requests pydicom

COPY auto_label.py .

LABEL org.nrg.commands="[{\"name\": \"auto_label\", \"label\": \"auto_label\", \"description\": \"Automatically labels incoming scans\", \"version\": \"1.0\", \"schema-version\": \"1.0\", \"image\": \"kkurkela92/auto_label:latest\", \"type\": \"docker\", \"command-line\": \"python auto_label.py --host \$XNAT_HOST --user \$XNAT_USER --pass \$XNAT_PASS --dicomdir /in --project #PROJ_ID# --subject #SUBJ_ID# --experiment #SESS_ID# --scan #SCAN_ID#\", \"override-entrypoint\": true, \"mounts\": [{\"name\": \"in\", \"writable\": false, \"path\": \"/input\"}, {\"name\": \"out\", \"writable\": true, \"path\": \"/output\"}], \"environment-variables\": {}, \"ports\": {}, \"inputs\": [{\"name\": \"SUBJ_ID\", \"description\": \"Subject ID\", \"type\": \"string\", \"required\": true, \"select-values\": []}, {\"name\": \"SESS_ID\", \"description\": \"Session ID\", \"type\": \"string\", \"required\": true, \"select-values\": []}, {\"name\": \"PROJ_ID\", \"description\": \"Project\", \"type\": \"string\", \"required\": true, \"select-values\": []}, {\"name\": \"SCAN_ID\", \"description\": \"Scan ID\", \"type\": \"string\", \"required\": true, \"select-values\": []}], \"outputs\": [{\"name\": \"output\", \"description\": \"The command's stdout\", \"required\": true, \"mount\": \"out\"}], \"xnat\": [{\"name\": \"debug-project\", \"label\": \"Debug\", \"description\": \"Run the debug container with a project mounted\", \"contexts\": [\"xnat:projectData\"], \"external-inputs\": [{\"name\": \"project\", \"description\": \"Input project\", \"type\": \"Project\", \"required\": true, \"provides-files-for-command-mount\": \"in\", \"load-children\": false}], \"derived-inputs\": [], \"output-handlers\": [{\"name\": \"output-resource\", \"accepts-command-output\": \"output\", \"as-a-child-of\": \"project\", \"type\": \"Resource\", \"label\": \"DEBUG_OUTPUT\", \"tags\": []}]}, {\"name\": \"debug-project-asset\", \"label\": \"Debug\", \"description\": \"Run the debug container with a project-asset mounted\", \"contexts\": [\"xnat:abstractProjectAsset\"], \"external-inputs\": [{\"name\": \"project-asset\", \"description\": \"Input project asset\", \"type\": \"ProjectAsset\", \"required\": true, \"provides-files-for-command-mount\": \"in\", \"load-children\": false}], \"derived-inputs\": [], \"output-handlers\": [{\"name\": \"output-resource\", \"accepts-command-output\": \"output\", \"as-a-child-of\": \"project-asset\", \"type\": \"Resource\", \"label\": \"DEBUG_OUTPUT\", \"tags\": []}]}, {\"name\": \"debug-subject\", \"description\": \"Run the debug container with a subject mounted\", \"contexts\": [\"xnat:subjectData\"], \"external-inputs\": [{\"name\": \"subject\", \"description\": \"Input subject\", \"type\": \"Subject\", \"required\": true, \"load-children\": false}], \"derived-inputs\": [], \"output-handlers\": [{\"name\": \"output-resource\", \"accepts-command-output\": \"output\", \"as-a-child-of\": \"subject\", \"type\": \"Resource\", \"label\": \"DEBUG_OUTPUT\", \"tags\": []}]}, {\"name\": \"debug-session\", \"label\": \"Debug\", \"description\": \"Run the debug container with a session mounted\", \"contexts\": [\"xnat:imageSessionData\"], \"external-inputs\": [{\"name\": \"session\", \"description\": \"Input session\", \"type\": \"Session\", \"required\": true, \"provides-files-for-command-mount\": \"in\", \"load-children\": false}], \"derived-inputs\": [], \"output-handlers\": [{\"name\": \"output-resource\", \"accepts-command-output\": \"output\", \"as-a-child-of\": \"session\", \"type\": \"Resource\", \"label\": \"DEBUG_OUTPUT\", \"tags\": []}]}, {\"name\": \"debug-scan\", \"label\": \"Debug\", \"description\": \"Run the debug container with a scan mounted\", \"contexts\": [\"xnat:imageScanData\"], \"external-inputs\": [{\"name\": \"scan\", \"description\": \"Input scan\", \"type\": \"Scan\", \"required\": true, \"provides-files-for-command-mount\": \"in\", \"load-children\": false}], \"derived-inputs\": [{\"name\": \"session\", \"type\": \"Session\", \"required\": true, \"load-children\": false, \"derived-from-wrapper-input\": \"scan\", \"multiple\": false}, {\"name\": \"session-id\", \"type\": \"string\", \"required\": true, \"provides-value-for-command-input\": \"SESS_ID\", \"load-children\": true, \"derived-from-wrapper-input\": \"scan\", \"derived-from-xnat-object-property\": \"id\", \"multiple\": false}, {\"name\": \"session-label\", \"type\": \"string\", \"required\": true, \"provides-value-for-command-input\": \"SESS_LABEL\", \"load-children\": true, \"derived-from-wrapper-input\": \"session\", \"derived-from-xnat-object-property\": \"label\", \"multiple\": false}, {\"name\": \"subject-id\", \"type\": \"string\", \"required\": true, \"provides-value-for-command-input\": \"SUBJ_ID\", \"load-children\": true, \"derived-from-wrapper-input\": \"session\", \"derived-from-xnat-object-property\": \"subject-id\", \"multiple\": false}, {\"name\": \"project\", \"type\": \"string\", \"required\": true, \"provides-value-for-command-input\": \"PROJ_ID\", \"load-children\": true, \"derived-from-wrapper-input\": \"session\", \"derived-from-xnat-object-property\": \"project-id\", \"multiple\": false}, {\"name\": \"scan-id\", \"type\": \"string\", \"required\": true, \"provides-value-for-command-input\": \"SCAN_ID\", \"load-children\": true, \"derived-from-wrapper-input\": \"scan\", \"derived-from-xnat-object-property\": \"id\", \"multiple\": false}], \"output-handlers\": [{\"name\": \"output-resource\", \"accepts-command-output\": \"output\", \"as-a-child-of\": \"scan\", \"type\": \"Resource\", \"label\": \"DEBUG_OUTPUT\", \"tags\": []}]}, {\"name\": \"debug-assessor\", \"label\": \"Debug\", \"description\": \"Run the debug container with a assessor mounted\", \"contexts\": [\"xnat:imageAssessorData\"], \"external-inputs\": [{\"name\": \"assessor\", \"description\": \"Input assessor\", \"type\": \"Assessor\", \"required\": true, \"provides-files-for-command-mount\": \"in\", \"load-children\": false}], \"derived-inputs\": [], \"output-handlers\": [{\"name\": \"output-resource\", \"accepts-command-output\": \"output\", \"as-a-child-of\": \"assessor\", \"type\": \"Resource\", \"label\": \"DEBUG_OUTPUT\", \"tags\": []}]}], \"container-labels\": {}, \"generic-resources\": {}, \"ulimits\": {}, \"secrets\": []}]"
